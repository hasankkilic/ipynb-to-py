<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <title>IPYNB → PY Converter – tool-convert</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header class="navbar">
        <div class="nav-inner">
            <div class="brand">
                <div class="brand-logo">
                    <span>TC</span>
                </div>
                <div class="brand-text">
                    <span class="brand-text-title">tool-convert</span>
                    <span class="brand-text-subtitle">IPYNB → PY Converter</span>
                </div>
            </div>
            <nav class="nav-links">
                <a href="index.html">Ana Sayfa</a>
                <a href="tools.html">Converters</a>
                <a href="contact.html">İletişim</a>
            </nav>
        </div>
    </header>

    <main class="page-wrap">
        <section class="hero">
            <div class="hero-kicker">IPYNB → PY</div>
            <h1 class="hero-title">Jupyter Notebook'tan hızlı Python script çıktısı.</h1>
            <p class="hero-subtitle">
                Dosyan tarayıcıda işlenir, sunucuya yüklenmez. Sadece kod
                hücreleri alınarak tek bir <code>.py</code> dosyası üretilir.
            </p>
        </section>

        <section class="card">
            <div class="converter-layout">
                <!-- Sol panel: dosya yükleme -->
                <div class="converter-panel">
                    <div class="converter-panel-header">
                        <div>
                            <div class="converter-panel-title">1. IPYNB dosyasını seç</div>
                            <div class="converter-panel-sub">
                                Jupyter Notebook (*.ipynb) – sadece kod hücreleri alınır.
                            </div>
                        </div>
                    </div>

                    <label class="file-drop" id="fileDrop">
                        <input type="file" id="fileInput" accept=".ipynb" />
                        <div id="fileDropText">
                            Dosyayı buraya sürükle & bırak veya tıklayıp seç.
                        </div>
                    </label>

                    <div class="btn-row">
                        <button class="btn btn-primary" id="convertBtn">
                            Dönüştür (.py üret)
                        </button>
                        <button class="btn" id="downloadBtn" disabled>
                            .py dosyasını indir
                        </button>
                        <button class="btn" id="clearBtn">
                            Temizle
                        </button>
                    </div>

                    <div class="status-line" id="statusLine">
                        Henüz dosya seçilmedi.
                    </div>
                </div>

                <!-- Sağ panel: çıktı -->
                <div class="converter-panel">
                    <div class="converter-panel-header">
                        <div>
                            <div class="converter-panel-title">2. Çıktı Python kodu</div>
                            <div class="converter-panel-sub">
                                İstersen kopyala, istersen .py olarak indir.
                            </div>
                        </div>
                    </div>

                    <textarea
                        id="outputArea"
                        class="code-output"
                        placeholder="# Dönüştürülen Python kodu burada görünecek..."
                    ></textarea>
                </div>
            </div>
        </section>
    </main>

    <script>
        const fileInput = document.getElementById("fileInput");
        const fileDrop = document.getElementById("fileDrop");
        const fileDropText = document.getElementById("fileDropText");
        const convertBtn = document.getElementById("convertBtn");
        const downloadBtn = document.getElementById("downloadBtn");
        const clearBtn = document.getElementById("clearBtn");
        const statusLine = document.getElementById("statusLine");
        const outputArea = document.getElementById("outputArea");

        let lastFileName = null;

        // Drag & drop efektleri
        fileDrop.addEventListener("dragover", (e) => {
            e.preventDefault();
            fileDrop.style.borderColor = "rgba(59, 130, 246, 0.9)";
        });

        fileDrop.addEventListener("dragleave", () => {
            fileDrop.style.borderColor = "rgba(55, 65, 81, 0.9)";
        });

        fileDrop.addEventListener("drop", (e) => {
            e.preventDefault();
            fileDrop.style.borderColor = "rgba(55, 65, 81, 0.9)";
            if (e.dataTransfer.files && e.dataTransfer.files[0]) {
                fileInput.files = e.dataTransfer.files;
                updateFileText();
            }
        });

        fileInput.addEventListener("change", updateFileText);

        function updateFileText() {
            if (fileInput.files.length > 0) {
                const f = fileInput.files[0];
                fileDropText.textContent = "Seçilen dosya: " + f.name;
                statusLine.textContent = "Dönüştürmeye hazırsın.";
                statusLine.className = "status-line status-ok";
                lastFileName = f.name;
            } else {
                fileDropText.textContent =
                    "Dosyayı buraya sürükle & bırak veya tıklayıp seç.";
                statusLine.textContent = "Henüz dosya seçilmedi.";
                statusLine.className = "status-line";
                lastFileName = null;
            }
        }

        convertBtn.addEventListener("click", () => {
            if (!fileInput.files || fileInput.files.length === 0) {
                statusLine.textContent = "Lütfen önce bir .ipynb dosyası seç.";
                statusLine.className = "status-line status-error";
                return;
            }

            const file = fileInput.files[0];
            const reader = new FileReader();

            reader.onload = (e) => {
                try {
                    const text = e.target.result;
                    const nb = JSON.parse(text);

                    if (!nb.cells || !Array.isArray(nb.cells)) {
                        throw new Error("Geçersiz notebook formatı (cells yok).");
                    }

                    let resultParts = [];
                    let cellIndex = 1;

                    nb.cells.forEach((cell) => {
                        if (cell.cell_type === "code") {
                            const sourceLines = cell.source || [];
                            const cellHeader =
                                "# ----- Cell " + cellIndex + " -----\\n";
                            resultParts.push(cellHeader + sourceLines.join(""));
                            cellIndex++;
                        }
                    });

                    if (resultParts.length === 0) {
                        outputArea.value =
                            "# Notebook içinde kod hücresi bulunamadı.";
                        statusLine.textContent =
                            "Kod hücresi bulunamadı. Çıktı alanı güncellendi.";
                        statusLine.className = "status-line status-error";
                        downloadBtn.disabled = true;
                        return;
                    }

                    const finalCode = resultParts.join(
                        "\\n\\n# -----\\n\\n"
                    );
                    outputArea.value = finalCode;

                    statusLine.textContent =
                        "Dönüştürme başarılı. Çıktıyı kopyalayabilir veya indirebilirsin.";
                    statusLine.className = "status-line status-ok";
                    downloadBtn.disabled = false;
                } catch (err) {
                    console.error(err);
                    statusLine.textContent =
                        "Dönüştürme sırasında hata oluştu: " + err.message;
                    statusLine.className = "status-line status-error";
                    downloadBtn.disabled = true;
                }
            };

            reader.onerror = () => {
                statusLine.textContent =
                    "Dosya okunurken bir hata oluştu.";
                statusLine.className = "status-line status-error";
                downloadBtn.disabled = true;
            };

            reader.readAsText(file, "utf-8");
        });

        downloadBtn.addEventListener("click", () => {
            const code = outputArea.value;
            if (!code.trim()) {
                return;
            }

            const blob = new Blob([code], { type: "text/x-python" });
            const url = URL.createObjectURL(blob);

            const a = document.createElement("a");

            // Dosya adını .py olarak türet
            let baseName = "notebook";
            if (lastFileName && lastFileName.endsWith(".ipynb")) {
                baseName = lastFileName.slice(0, -6);
            }
            a.download = baseName + ".py";
            a.href = url;
            a.click();

            URL.revokeObjectURL(url);
        });

        clearBtn.addEventListener("click", () => {
            fileInput.value = "";
            outputArea.value = "";
            downloadBtn.disabled = true;
            fileDropText.textContent =
                "Dosyayı buraya sürükle & bırak veya tıklayıp seç.";
            statusLine.textContent = "Henüz dosya seçilmedi.";
            statusLine.className = "status-line";
            lastFileName = null;
        });
    </script>
</body>
</html>
